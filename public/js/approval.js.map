{"version":3,"file":"/js/approval.js","mappings":"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","sources":["webpack:///./resources/js/_comments.js","webpack:///./resources/js/approval.js"],"sourcesContent":["export const commentsHelper = function () {\n    'use strict';\n\n    let data = {\n        'commentTemplate': null,\n        'commentCardTemplate': null\n    };\n\n    let css = {\n        'mainContainer': '#assignmentContainer',\n        'viewTypes': {\n            'grid': 'ajr-grid',\n            'list': 'ajr-list'\n        },\n        'modals': {\n            'comment': '#commentModal'\n        },\n        'comments': {\n            'form': '#newComment',\n            'formError': '#commentError'\n        },\n        'household': {\n            'container': '.household',\n            'comments': '.allComments',\n            'status': '.status',\n            'error': '.statusError'\n        }\n    };\n\n    let functions = {\n    \t'init' : function(createUrl) {\n    \t\t$.ajaxSetup({\n\t\t\t    headers: {\n\t\t\t        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n\t\t\t    }\n\t\t\t});\n    \t},\n    \t'setDataAttr' : function(attr, val) {\n    \t\tdata[attr] = val;\n    \t},\n    \t'getDataAttr' : function(attr) {\n    \t\treturn data[attr];\n    \t},\n    \t'getAllData' : function() {\n    \t\treturn data;\n    \t},\n        'createComment' : function(params) {\n    \t\t$.ajax({\n                url: params.url,\n                type: 'post',\n                data: params.data,\n                success: function(response) {\n                    params.successCallback(response);\n                }\n            });\n    \t},\n    \t'buildComments' : function(template, container, comments, emptyMessage) {\n    \t\tif(typeof emptyMessage === 'undefined') {\n                emptyMessage = 'No comments yet.';\n            }\n\n            container.html('');\n\n            if(comments.length === 0) {\n                container.html('<p>' + emptyMessage + '</p>');\n            }else {\n    \t\t    $.each(comments, function(index, comment) {\n                    let author = comment.author;\n\n                    if(typeof author === 'undefined') {\n                        author = comment.authorInfo;\n                    }\n                    \n    \t\t\t\t// let authorInfo = author.name + ' - ' + _moment(comment.updated_at).format('YYYY-MM-DD LT');\n    \t\t\t\tlet newComment = template(comment.id, comment.body, author.name, _moment(comment.updated_at).format('YYYY-MM-DD LT'));\n    \t\t\t\tcontainer.prepend(newComment);\n    \t\t\t});\n            }\n    \t},\n    \t'setCommentError' : function(container, error) {\n    \t\tcontainer.html(error);\n    \t},\n    \t'resetCommentForm' : function(form) {\n    \t\tform.reset();\n    \t},\n        'showCommentsAjaxLoader' : function(container) {\n            container.find('.ajax-loader').removeClass('d-none');\n        },\n        'hideCommentsAjaxLoader' : function(container) {\n            container.find('.ajax-loader').addClass('d-none');\n        }\n    };\n\n    return {\n        data : functions.getAllData,\n        functions: functions\n    }\n}();\n","import {commentsHelper} from './_comments.js';\n\nwindow.approvalHelper = function () {\n    'use strict';\n\n    var data = {\n        'currentAssignmentId': null\n    };\n\n    var css = {\n        'mainContainer': '#assignmentContainer',\n        'viewTypes': {\n            'grid': 'ajr-grid',\n            'list': 'ajr-list'\n        },\n        'modals': {\n            'comment': '#commentModal'\n        },\n        'comments': {\n            'form': '#newComment',\n            'formError': '#commentError'\n        },\n        'household': {\n            'container': '.household',\n            'comments': '.allComments',\n            'status': '.status',\n            'error': '.statusError'\n        }\n    };\n\n    const commentTemplate = function commentTemplate(id, body, author ) {\n        return `\n            <div class='ministeringComment' data-commentid=\"${id}\">\n                <author>${author}</author>\n                <p class=\"commentBody\">${body}</p>\n            </div>\n        `;\n    };\n\n    var functions = {\n    \t'init' : function(households) {\n    \t\t$.ajaxSetup({\n\t\t\t    headers: {\n\t\t\t        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n\t\t\t    }\n\t\t\t});\n\n            $('.household').each(function() {\n                functions.handleBtnGroup($(this));\n            });\n\n            commentsHelper.functions.init();\n            commentsHelper.functions.setDataAttr('commentTemplate', commentTemplate);\n    \t},\n    \t'setDataAttr' : function(attr, val) {\n    \t\tdata[attr] = val;\n    \t},\n    \t'getDataAttr' : function(attr) {\n    \t\treturn data[attr];\n    \t},\n    \t'getAllData' : function() {\n    \t\treturn data;\n    \t},\n        'getActiveContainerById' : function(assignmentId) {\n            return $('[data-assignmentid=\"' + assignmentId + '\"] ' + css.household.comments);\n        },\n    \t'createComment' : function() {\n    \t\tconst form = $(css.comments.form);\n            const assignmentId = form.find('#assignmentId').val();\n            functions.setDataAttr('currentAssignmentId', assignmentId);\n\n            let params = {\n                'url' : '/api/assignment/' + assignmentId + '/comments/create',\n                'data' : {\n                    form: JSON.stringify(form.serializeArray().reduce(function(m,o){  m[o.name] = o.value; return m;}, {}))\n                },\n                'successCallback' : functions.commentCreateSuccess\n            };\n\n            commentsHelper.functions.createComment(params);\n    \t},\n        'commentCreateSuccess' : function(response) {\n            if(response.saved) {\n                commentsHelper.functions.resetCommentForm(\n                    $(css.comments.form)[0]\n                );\n                commentsHelper.functions.buildComments(\n                    commentsHelper.functions.getDataAttr('commentTemplate'),\n                    functions.getActiveContainerById(functions.getDataAttr('currentAssignmentId')),\n                    response.comments,\n                    'No feedback provided.'\n                );\n                $(css.modals.comment).modal('hide');\n            } else {\n                commentsHelper.functions.setCommentError(\n                    $(css.comments.formError),\n                    'Could not save your comment. Refresh the page and try again.'\n                );\n            }\n        },\n    \t'updateStatus' : function(btn, status) {\n            let container = btn.closest(css.household.container);\n            let assignmentId = container.data('assignmentid');\n            // let householdId = container.data('householdid');\n\n            $.ajax({\n                url: '/api/assignment/' + assignmentId + '/' + status,\n                type: 'post',\n                data: {},\n                success: function(response) {\n                    if(response.saved) {\n                        $(css.household.status, container).html(response.status);\n                        $(container).removeClass().addClass('household ' + response.status);\n                        functions.handleBtnGroup(container);\n                    } else {\n                        functions.setStatusError('Could not update the status. Refresh the page and try again.');\n                    }\n                }\n            });\n        },\n        'setStatusError' : function(error) {\n            $(css.household.error).html(error);\n        },\n        'handleBtnGroup' : function(container) {\n            $('.btn-group', container)\n                .find('button')\n                .removeClass('fake-last')\n                .removeClass('fake-first');\n\n            $('.btn-group', container)\n                .find('button')\n                .not(':hidden')\n                .last()\n                .addClass('fake-last');\n\n            $('.btn-group', container)\n                .find('button')\n                .not(':hidden')\n                .first()\n                .addClass('fake-first');\n        },\n        'changeViewType' : function(viewType) {\n            switch(viewType) {\n                case 'grid':\n                    $(css.mainContainer).removeClass(css.viewTypes.list).addClass(css.viewTypes.grid);\n                    break;\n                case 'list':\n                default:\n                    $(css.mainContainer).addClass(css.viewTypes.list).removeClass(css.viewTypes.grid);\n                    break;\n            }\n        },\n        'filterAssignments' : function(status) {\n            $(\"#assignmentContainer .household\").addClass('d-none');\n            $(\"#assignmentContainer .household.\" + status).removeClass('d-none');\n\n            if(status === 'all' || status === '') {\n                $(\"#assignmentContainer .household\").removeClass('d-none');\n            }\n        }\n    };\n\n\t$(document).on('click touch', '#submitComment', function(e) {\n\t\te.preventDefault();\n\t\tfunctions.createComment();\n    });   \n\n    $(document).on('click touch', '.acceptAssignment', function(e) {\n        functions.updateStatus($(this), 'accept');\n    });\n\n    $(document).on('click touch', '.rejectAssignment', function(e) {\n        functions.updateStatus($(this), 'reject');\n    });\n\n    $(document).on('click touch', '.resetStatus', function(e) {\n        functions.updateStatus($(this), 'propose');\n    });\n\n    $(document).on('click touch', '#viewChoice li', function() {\n        functions.changeViewType($(this).data('viewtype'));\n    });\n\n    $(document).on('click touch', '#filterChoice li', function() {\n        functions.filterAssignments($(this).data('status'));\n    });\n\n    return {\n        data : functions.getAllData,\n        functions: functions\n    }\n}();\n"],"names":["data","functions","commentsHelper","createUrl","$","ajaxSetup","headers","attr","val","params","ajax","url","type","success","response","successCallback","template","container","comments","emptyMessage","html","length","each","index","comment","author","authorInfo","newComment","id","body","name","_moment","updated_at","format","prepend","error","form","reset","find","removeClass","addClass","getAllData","window","approvalHelper","css","commentTemplate","households","handleBtnGroup","this","init","setDataAttr","assignmentId","JSON","stringify","serializeArray","reduce","m","o","value","commentCreateSuccess","createComment","saved","resetCommentForm","buildComments","getDataAttr","getActiveContainerById","modal","setCommentError","formError","btn","status","closest","setStatusError","not","last","first","viewType","list","grid","document","on","e","preventDefault","updateStatus","changeViewType","filterAssignments"],"sourceRoot":""}