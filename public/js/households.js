(()=>{"use strict";var t,e,o=(t={commentTemplate:null},{data:(e={init:function(t){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})},setDataAttr:function(e,o){t[e]=o},getDataAttr:function(e){return t[e]},getAllData:function(){return t},createComment:function(t){$.ajax({url:t.url,type:"post",data:t.data,success:function(e){t.successCallback(e)}})},buildComments:function(e,o,n){void 0===n&&(n="No comments yet."),e.html(""),0===o.length?e.html("<p>"+n+"</p>"):$.each(o,(function(o,n){var a=n.author;void 0===a&&(a=n.authorInfo);var m=a.name+" - "+_moment(n.updated_at).format("YYYY-MM-DD LT"),s=t.commentTemplate(n.id,n.body,m);e.prepend(s)}))},setCommentError:function(t,e){t.html(e)},resetCommentForm:function(t){t.reset()},showCommentsAjaxLoader:function(t){t.find(".ajax-loader").removeClass("d-none")},hideCommentsAjaxLoader:function(t){t.find(".ajax-loader").addClass("d-none")}}).getAllData,functions:e});window.householdsHelper=function(){var t={households:null,currentHouseholdId:null},e=e={mainContainer:"#householdsContainer",modals:{comment:"#commentModal",household:{container:"#householdModal",comments:".allComments"}},comments:{form:"#newComment",formError:"#commentError",commentCount:".count",buttons:".commentBtns"},household:{container:".household",comments:".allComments"}},n=function(t,e,o){return"\n            <div class='householdComment' data-commentid=\"".concat(t,'">\n                <author>').concat(o,'</author>\n                <p class="commentBody">').concat(e,"</p>\n            </div>\n        ")},a={init:function(t){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),a.setDataAttr("households",t),o.functions.init(),o.functions.setDataAttr("commentTemplate",n)},setDataAttr:function(e,o){t[e]=o},getDataAttr:function(e){return t[e]},getAllData:function(){return t},getActiveContainerById:function(t){return $('[data-householdid="'+t+'"] ')},createComment:function(){var t=$(e.comments.form),n=t.find("#householdId").val();a.setDataAttr("currentHouseholdId",n);var m={url:"/api/household/"+n+"/comments/create",data:{form:JSON.stringify(t.serializeArray().reduce((function(t,e){return t[e.name]=e.value,t}),{}))},successCallback:a.commentCreateSuccess};o.functions.createComment(m)},commentCreateSuccess:function(t){if(t.saved){a.replaceHouseholdComments(t.comments),o.functions.resetCommentForm($(e.comments.form)[0]);var n=a.getActiveContainerById(a.getDataAttr("currentHouseholdId"));o.functions.buildComments(n.find(e.household.comments),t.comments,"No comments yet.");var m=t.comments.length,s=parseInt($(e.mainContainer).data("maxcommentsshown"));n.find(e.comments.commentCount).text(m),m>s&&n.addClass("showAllCommentsBtn"),a.handleBtnGroup(n.find(e.comments.buttons)),$(e.modals.comment).modal("hide")}else o.functions.setCommentError($(e.comments.formError),"Could not save your comment. Refresh the page and try again.")},populateHouseholdModal:function(t){var n=t.closest(".household").data("householdid"),m=a.getHouseholdById(n),s=$(e.modals.household.container);a.setDataAttr("currentHouseholdId"),s.find(".householdName").text(m.fullHouseholdName),o.functions.buildComments($(e.modals.household.comments,s),m.comments,"No comments yet.")},replaceHouseholdComments:function(e){var o=t.households.findIndex((function(t){return t.id===parseInt(a.getDataAttr("currentHouseholdId"))}));t.households[o].comments=e},getHouseholdById:function(e){return t.households.filter((function(t){return t.id===e}))[0]},handleBtnGroup:function(t){1===$(".btn-group",t).find("button").not(":hidden").length?t.removeClass("btn-group").addClass("full-width"):t.addClass("btn-group").removeClass("full-width")}};return $(document).on("click touch","#submitComment",(function(t){t.preventDefault(),a.createComment()})),{data:a.getAllData,functions:a}}()})();
//# sourceMappingURL=households.js.map