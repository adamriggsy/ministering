(()=>{"use strict";var t,e,o=(t={commentTemplate:null,commentCardTemplate:null},{data:(e={init:function(t){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})},setDataAttr:function(e,o){t[e]=o},getDataAttr:function(e){return t[e]},getAllData:function(){return t},createComment:function(t){$.ajax({url:t.url,type:"post",data:t.data,success:function(e){t.successCallback(e)}})},buildComments:function(t,e,o,n){void 0===n&&(n="No comments yet."),e.html(""),0===o.length?e.html("<p>"+n+"</p>"):$.each(o,(function(o,n){var a=n.author;void 0===a&&(a=n.authorInfo);var s=t(n.id,n.body,a.name,_moment(n.updated_at).format("YYYY-MM-DD LT"));e.prepend(s)}))},setCommentError:function(t,e){t.html(e)},resetCommentForm:function(t){t.reset()},showCommentsAjaxLoader:function(t){t.find(".ajax-loader").removeClass("d-none")},hideCommentsAjaxLoader:function(t){t.find(".ajax-loader").addClass("d-none")}}).getAllData,functions:e});function n(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function a(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){s(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}window.householdsHelper=function(){var t={households:{},currentHouseholdId:null,householdSearch:null,ac:null,maxCommentsShown:4},e=e={mainContainer:"#householdsContainer",modals:{comment:"#commentModal",household:{container:"#householdModal",comments:".allComments"}},comments:{form:"#newComment",formError:"#commentError",commentCount:".count",buttons:".commentBtns"},household:{container:"#householdsContainer .household",comments:".allComments",name:".householdName",count:".count",commentButton:".commentBtn"},search:{input:"#searchHouseholds"}},n=function(t,e,o,n){return"\n            <div class='householdComment' data-commentid=\"".concat(t,'">\n                <author>').concat(o," - ").concat(n,'</author>\n                <p class="commentBody">').concat(e,"</p>\n            </div>\n        ")},s=function(t,e,o,n){return"\n            <div class='householdComment-card' data-commentid=\"".concat(t,'">\n                <author>\n                    <p class="authorName">\n                        ').concat(o,'\n                    </p>\n                    <p class="commentDate">\n                        ').concat(n,'\n                    </p>\n                </author>\n                <p class="commentBody">').concat(e,"</p>\n            </div>\n        ")},c={init:function(a,m){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),t.households[a.id]=a,c.setDataAttr("householdSearch",m),c.setDataAttr("maxCommentsShown",$(e.mainContainer).data("maxcommentsshown")),c.setAutocomplete(),o.functions.init(),o.functions.setDataAttr("commentTemplate",n),o.functions.setDataAttr("commentCardTemplate",s)},setDataAttr:function(e,o){t[e]=o},getDataAttr:function(e){return t[e]},getAllData:function(){return t},getActiveContainerById:function(t){return $('[data-householdid="'+t+'"] ')},createComment:function(){var t=$(e.comments.form),n=t.find("#householdId").val();c.setDataAttr("currentHouseholdId",n);var a={url:"/api/household/"+n+"/comments/create",data:{form:JSON.stringify(t.serializeArray().reduce((function(t,e){return t[e.name]=e.value,t}),{}))},successCallback:c.commentCreateSuccess};o.functions.createComment(a)},commentCreateSuccess:function(t){if(t.saved){c.replaceHouseholdComments(t.comments),o.functions.resetCommentForm($(e.comments.form)[0]);var n=c.getActiveContainerById(c.getDataAttr("currentHouseholdId"));o.functions.buildComments(o.functions.getDataAttr("commentTemplate"),n.find(e.household.comments),t.comments,"No comments yet.");var a=t.comments.length,s=parseInt($(e.mainContainer).data("maxcommentsshown"));n.find(e.comments.commentCount).text(a),a>s&&n.addClass("showAllCommentsBtn"),c.handleBtnGroup(n.find(e.comments.buttons)),$(e.modals.comment).modal("hide")}else o.functions.setCommentError($(e.comments.formError),"Could not save your comment. Refresh the page and try again.")},populateHouseholdModal:function(t){var n=t.closest(".household").data("householdid"),a=c.getHouseholdById(n),s=$(e.modals.household.container);c.setDataAttr("currentHouseholdId"),s.find(".householdName").text(a.fullHouseholdName),o.functions.buildComments(o.functions.getDataAttr("commentTemplate"),$(e.modals.household.comments,s),a.comments,"No comments yet.")},replaceHouseholdComments:function(e){var o=t.households.findIndex((function(t){return t.id===parseInt(c.getDataAttr("currentHouseholdId"))}));t.households[o].comments=e},getHouseholdById:function(e){return t.households[e]},handleBtnGroup:function(t){1===t.find("button").not(":hidden").length?t.removeClass("btn-group").addClass("full-width"):t.addClass("btn-group").removeClass("full-width")},setAutocomplete:function(){$("#householdSearch").html("").append('<input type="text" class="form-control form-control-lg" id="searchHouseholds" placeholder="Find a household..." autocomplete="off">'),c.setDataAttr("ac",!1);var t=document.getElementById("searchHouseholds"),e=new Autocomplete(t,{data:householdsHelper.functions.getDataAttr("householdSearch"),maximumItems:10,treshold:1,highlightTyped:!1,onSelectItem:function(t){t.label;var e=t.value;c.getHouseholdData(parseInt(e))}});c.setDataAttr("ac",e)},showHousehold:function(t){var n=$(e.household.container).first().clone();o.functions.buildComments(o.functions.getDataAttr("commentCardTemplate"),$(e.household.comments,n),t.comments);var a=t.comments.length>c.getDataAttr("maxCommentsShown")?"showAllCommentsBtn":"";n.removeClass().addClass("household "+a),n.data("householdid",t.household.id),$(e.household.name,n).text(t.household.fullHouseholdName),$(e.household.count,n).text(t.comments.length),c.resetHouseholdVisibility(n),$(e.mainContainer).prepend(n),c.handleBtnGroup(n.find(e.comments.buttons)),$(e.search.input).val("")},getHouseholdData:function(t){$.getJSON("/api/household/"+t,(function(t){c.addToHouseholds(t),c.showHousehold(t)}))},addToHouseholds:function(e){t.households[e.household.id]=a(a({},e.household),{},{comments:e.comments})},toggleHouseholdVisibility:function(t){t.find(".canHide").toggle(850),t.find(".content-hide").toggleClass("bi-plus-circle-dotted bi-dash-circle-dotted")},resetHouseholdVisibility:function(t){t.find(".canHide").show(),t.find(".content-hide").removeClass().addClass("content-hide bi-dash-circle-dotted")}};return $(document).on("click touch","#submitComment",(function(t){t.preventDefault(),c.createComment()})),$(document).on("click touch",".content-hide",(function(t){t.preventDefault(),c.toggleHouseholdVisibility($(this).closest(".household"))})),{data:c.getAllData,functions:c}}()})();
//# sourceMappingURL=households.js.map