(()=>{"use strict";var e,t,o=(e={commentTemplate:null},{data:(t={init:function(e){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})},setDataAttr:function(t,o){e[t]=o},getDataAttr:function(t){return e[t]},getAllData:function(){return e},createComment:function(e){$.ajax({url:e.url,type:"post",data:e.data,success:function(t){e.successCallback(t)}})},buildComments:function(t,o,n){void 0===n&&(n="No comments yet."),t.html(""),0===o.length?t.html("<p>"+n+"</p>"):$.each(o,(function(o,n){var s=n.author;void 0===s&&(s=n.authorInfo);var a=s.name+" - "+_moment(n.updated_at).format("YYYY-MM-DD LT"),i=e.commentTemplate(n.id,n.body,a);t.prepend(i)}))},setCommentError:function(e,t){e.html(t)},resetCommentForm:function(e){e.reset()},showCommentsAjaxLoader:function(e){e.find(".ajax-loader").removeClass("d-none")},hideCommentsAjaxLoader:function(e){e.find(".ajax-loader").addClass("d-none")}}).getAllData,functions:t});window.ministeringHelper=function(){var e={households:null,unassignedHouseholds:!1,activeHousehold:null,ac:!1,tickerTemplate:null},t={container:"#activeHousehold",household:{container:"#householdContainer",name:".householdName",husband:".husbandName",wife:".wifeName",minTo:"#assignedToVisitContainer",assignedReceive:"#visitingHousehold"},ministering:{container:"#ministeringInfo",assigned:{container:"#assignedToVisitContainer"},visiting:{container:"#visitingHousehold"}},comments:{container:"#householdComments",allComments:"#commentsContainer",view:"#view",form:"#newComment",formError:"#commentError",nav:{view:"#commentNavView",create:"#commentNavCreate"}}},n={container:".household",last_name:".hh_lastName",husband:".hh_husbandName",wife:".hh_wifeName",minSis:".hh_ministeringSis",minBro:".hh_ministeringBro",minTo:".hh_ministeringTo"},s={mainContainer:"#unassignedTicker",container:"#unassignedTicker .ticker"},a=function(e,t,o){return"\n            <div class='houseComment' data-commentid=\"".concat(e,'">\n                <author>').concat(o,'</author>\n                <p class="commentBody">').concat(t,"</p>\n            </div>\n        ")},i=function(e){return'\n            <div class="ticker__item">'.concat(e,"</div>\n        ")},d={init:function(e){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),d.setDataAttr("households",e),d.setDataAttr("tickerTemplate",i),d.getUnassignedHouseholds(),o.functions.init(),o.functions.setDataAttr("commentTemplate",a)},setDataAttr:function(t,o){e[t]=o},getDataAttr:function(t){return e[t]},getAllData:function(){return e},workOnHousehold:function(e){var o=d.getHouseholdById(e.data("householdid"));d.setDataAttr("activeHousehold",o);var n=t,s=$(n.container);s.data("activeid",o.id),$(n.household.name,s).html(o.last_name),$(n.household.husband,s).html(o.husbandName),$(n.household.wife,s).html(o.wifeName),$(n.household.minTo,s).html(""),$.each(o.ministerTo,(function(e,t){$(n.household.minTo,s).append('<p class="minToHouse" data-householdid="'+e+'">'+t+'<i class="removeAssigned bi-x-circle small text-danger"></i></p>')})),$(n.household.assignedReceive).children().remove(),""!==o.ministeringBrother&&$(n.household.assignedReceive).append("<p>"+o.ministeringBrother+"</p>"),""!==o.ministeringSister&&$(n.household.assignedReceive).append("<p>"+o.ministeringSister+"</p>"),$(t.container).removeClass("d-none"),d.getHouseholdComments()},setAutocomplete:function(){$("#assignHouseholdContainer").html("").append('<input type="text" class="form-control" id="assignHousehold" placeholder="Start typing..." autocomplete="off">'),d.setDataAttr("ac",!1);var e=document.getElementById("assignHousehold"),t=new Autocomplete(e,{data:ministeringHelper.functions.getDataAttr("unassignedHouseholds"),maximumItems:10,treshold:1,highlightTyped:!1,onSelectItem:function(e){e.label;var t=e.value;d.assignHousehold(t)}});d.setDataAttr("ac",t)},getHouseholdById:function(t){return e.households.filter((function(e){return e.id===t}))[0]},getUnassignedHouseholds:function(){$.getJSON("/api/households/unassigned",(function(e){d.setDataAttr("unassignedHouseholds",e),d.setDataAttr("ac",!1),d.setAutocomplete(),d.updateTicker()}))},assignHousehold:function(e){var o=d.getDataAttr("activeHousehold");$.ajax({url:"/api/assign",type:"post",data:{householdId:o.id,assignedId:e},success:function(e){d.updateHouseholds(e.household),d.updateHouseholds(e.assignedHousehold),$(t.household.minTo).append('<p class="minToHouse" data-householdid="'+e.assignedHousehold.id+'">'+e.assignedHousehold.householdName+'<i class="removeAssigned bi-x-circle small text-danger"></i></p>'),$("#assignHousehold").val(""),d.getUnassignedHouseholds(),d.resetDataTable()}})},updateHouseholds:function(e){d.replaceHouseholdData(e);var t=$(".household[data-householdid='"+e.id+"']");$(n.minSis,t).html(e.ministeringSister),$(n.minBro,t).html(e.ministeringBrother),$(n.minTo,t).html(""),$.each(e.ministerTo,(function(e,o){$(n.minTo,t).append("<p>"+o+"</p>")}))},replaceHouseholdData:function(t){var o=e.households.findIndex((function(e){return e.id===t.id}));e.households[o]=t},removeActiveVisiting:function(){var e=d.getDataAttr("activeHousehold");$(t.household.assignedReceive).children().length>0&&$.ajax({url:"/api/remove-visiting",type:"post",data:{householdId:e.id},success:function(e){d.updateHouseholds(e.household),d.updateHouseholds(e.otherHousehold),$(t.household.assignedReceive).html(""),$("#assignHousehold").val(""),d.getUnassignedHouseholds(),d.resetDataTable()}})},removeAssignedMinTo:function(e){var o=e.data("householdid"),n=d.getDataAttr("activeHousehold");$.ajax({url:"/api/remove-assigned",type:"post",data:{householdId:n.id,assignedId:o},success:function(e){d.updateHouseholds(e.household),d.updateHouseholds(e.otherHousehold),$(t.household.minTo+" .minToHouse[data-householdid='"+o+"']").remove(),$("#assignHousehold").val(""),d.getUnassignedHouseholds(),d.resetDataTable()}})},resetDataTable:function(){$.fn.dataTable.isDataTable("#allHouseholdsTable")&&$("#allHouseholdsTable").DataTable().destroy(),$("#allHouseholdsTable").DataTable({paging:!1,order:[],columns:[{targets:0,orderable:!1,width:"1%"},{targets:1,width:"5%"},{targets:2,width:"5%"},{targets:3,width:"5%"},{targets:4,orderable:!1,width:"14%"},{targets:5,orderable:!1,width:"14%"},{targets:6,orderable:!1,width:"14%"},{targets:7,orderable:!1,width:"14%"}]})},getHouseholdComments:function(){o.functions.showCommentsAjaxLoader($(t.comments.view)),$.getJSON("/api/household/"+e.activeHousehold.id+"/comments",(function(e){o.functions.buildComments($(t.comments.allComments),e),o.functions.hideCommentsAjaxLoader($(t.comments.view))}))},createComment:function(){var e=$(t.comments.form),n={url:"/api/household/"+d.getDataAttr("activeHousehold").id+"/comments/create",data:{form:JSON.stringify(e.serializeArray().reduce((function(e,t){return e[t.name]=t.value,e}),{}))},successCallback:d.commentCreateSuccess};o.functions.createComment(n)},commentCreateSuccess:function(e){e.saved?($(t.comments.nav.view).find(".nav-link").click(),o.functions.showCommentsAjaxLoader($(t.comments.view)),o.functions.buildComments($(t.comments.allComments),e.comments,"No comments yet."),o.functions.hideCommentsAjaxLoader($(t.comments.view)),o.functions.resetCommentForm($(t.comments.form)[0])):o.functions.setCommentError($(t.comments.formError),"Could not save your comment. Refresh the page and try again.")},updateTicker:function(){var t=_.clone(d.getDataAttr("unassignedHouseholds")),o=_.shuffle(t);$(s.container).append(e.tickerTemplate("Unassigned Households: ")),$.each(_.slice(o,0,50),(function(t,o){$(s.container).append(e.tickerTemplate(o.label))}))}};return $(document).on("click touch",".assignHousehold",(function(){d.workOnHousehold($(this).closest(n.container)),$([document.documentElement,document.body]).animate({scrollTop:$(t.container).offset().top},1e3)})),$(document).on("click touch",".removeVisiting",(function(){d.removeActiveVisiting()})),$(document).on("click touch",".removeAssigned",(function(){d.removeAssignedMinTo($(this).closest(".minToHouse"))})),$(document).on("click touch","#activeClose",(function(){$(t.container).addClass("d-none")})),$(document).on("click touch","#commentSubmit",(function(e){e.preventDefault(),d.createComment()})),$(document).on("click touch","#commentNavCreate",(function(){o.functions.setCommentError($(t.comments.formError),"")})),$(document).on("click touch","#tickerClose",(function(){$(s.mainContainer).remove()})),{data:d.getAllData,functions:d}}()})();
//# sourceMappingURL=ministering.js.map