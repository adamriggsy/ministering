(()=>{"use strict";var t,e,n=(t={commentTemplate:null,commentCardTemplate:null},{data:(e={init:function(t){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})},setDataAttr:function(e,n){t[e]=n},getDataAttr:function(e){return t[e]},getAllData:function(){return t},createComment:function(t){$.ajax({url:t.url,type:"post",data:t.data,success:function(e){t.successCallback(e)}})},buildComments:function(t,e,n,a){void 0===a&&(a="No comments yet."),e.html(""),0===n.length?e.html("<p>"+a+"</p>"):$.each(n,(function(n,a){var o=a.author;void 0===o&&(o=a.authorInfo);var r=t(a.id,a.body,o.name,_moment(a.updated_at).format("YYYY-MM-DD LT"));e.prepend(r)}))},setCommentError:function(t,e){t.html(e)},resetCommentForm:function(t){t.reset()},showCommentsAjaxLoader:function(t){t.find(".ajax-loader").removeClass("d-none")},hideCommentsAjaxLoader:function(t){t.find(".ajax-loader").addClass("d-none")}}).getAllData,functions:e});window.approvalHelper=function(){var t={currentMinisterId:null},e="#assignmentContainer",a={grid:"ajr-grid",list:"ajr-list"},o={comment:"#commentModal"},r={form:"#newComment",formError:"#commentError"},s={container:".household",comments:".allComments",status:".status",error:".statusError"},i=function(t,e,n){return"\n            <div class='ministeringComment' data-commentid=\"".concat(t,'">\n                <author>').concat(n,'</author>\n                <p class="commentBody">').concat(e,"</p>\n            </div>\n        ")},c={init:function(t){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".household").each((function(){c.handleBtnGroup($(this))})),n.functions.init(),n.functions.setDataAttr("commentTemplate",i)},setDataAttr:function(e,n){t[e]=n},getDataAttr:function(e){return t[e]},getAllData:function(){return t},getActiveContainerById:function(t){return $('[data-ministerid="'+t+'"] '+s.comments)},createComment:function(){var t=$(r.form),e=t.find("#ministerId").val();c.setDataAttr("currentMinisterId",e);var a={url:"/api/minister-to/"+e+"/comments/create",data:{form:JSON.stringify(t.serializeArray().reduce((function(t,e){return t[e.name]=e.value,t}),{}))},successCallback:c.commentCreateSuccess};n.functions.createComment(a)},commentCreateSuccess:function(t){t.saved?(n.functions.resetCommentForm($(r.form)[0]),n.functions.buildComments(n.functions.getDataAttr("commentTemplate"),c.getActiveContainerById(c.getDataAttr("currentMinisterId")),t.comments,"No feedback provided."),$(o.comment).modal("hide")):n.functions.setCommentError($(r.formError),"Could not save your comment. Refresh the page and try again.")},updateStatus:function(t,e){var n=t.closest(s.container),a=(n.data("ministerid"),n.data("householdid"));$.ajax({url:"/api/minister-to/household/"+a+"/"+e,type:"post",data:{},success:function(t){t.saved?($(s.status,n).html(t.status),$(n).removeClass().addClass("household "+t.status),c.handleBtnGroup(n)):c.setStatusError("Could not update the status. Refresh the page and try again.")}})},setStatusError:function(t){$(s.error).html(t)},handleBtnGroup:function(t){$(".btn-group",t).find("button").removeClass("fake-last").removeClass("fake-first"),$(".btn-group",t).find("button").not(":hidden").last().addClass("fake-last"),$(".btn-group",t).find("button").not(":hidden").first().addClass("fake-first")},changeViewType:function(t){switch(t){case"grid":$(e).removeClass(a.list).addClass(a.grid);break;case"list":default:$(e).addClass(a.list).removeClass(a.grid)}}};return $(document).on("click touch","#submitComment",(function(t){t.preventDefault(),c.createComment()})),$(document).on("click touch",".acceptAssignment",(function(t){c.updateStatus($(this),"accept")})),$(document).on("click touch",".rejectAssignment",(function(t){c.updateStatus($(this),"reject")})),$(document).on("click touch",".resetStatus",(function(t){c.updateStatus($(this),"propose")})),$(document).on("click touch","#viewChoice li",(function(){c.changeViewType($(this).data("viewtype"))})),{data:c.getAllData,functions:c}}()})();
//# sourceMappingURL=approval.js.map