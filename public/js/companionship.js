(()=>{"use strict";var n,o,e=(n={commentTemplate:null,commentCardTemplate:null},{data:(o={init:function(n){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})},setDataAttr:function(o,e){n[o]=e},getDataAttr:function(o){return n[o]},getAllData:function(){return n},createComment:function(n){$.ajax({url:n.url,type:"post",data:n.data,success:function(o){n.successCallback(o)}})},buildComments:function(n,o,e,t){void 0===t&&(t="No comments yet."),o.html(""),0===e.length?o.html("<p>"+t+"</p>"):$.each(e,(function(e,t){var a=t.author;void 0===a&&(a=t.authorInfo);var i=n(t.id,t.body,a.name,_moment(t.updated_at).format("YYYY-MM-DD LT"));o.prepend(i)}))},setCommentError:function(n,o){n.html(o)},resetCommentForm:function(n){n.reset()},showCommentsAjaxLoader:function(n){n.find(".ajax-loader").removeClass("d-none")},hideCommentsAjaxLoader:function(n){n.find(".ajax-loader").addClass("d-none")}}).getAllData,functions:o});function t(n,o){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),e.push.apply(e,t)}return e}function a(n){for(var o=1;o<arguments.length;o++){var e=null!=arguments[o]?arguments[o]:{};o%2?t(Object(e),!0).forEach((function(o){i(n,o,e[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):t(Object(e)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(e,o))}))}return n}function i(n,o,e){return o in n?Object.defineProperty(n,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[o]=e,n}window.companionshipHelper=function(){var n={companionships:null,unassignedIndividuals:!1,activeCompanionship:null,ac:!1,newCompanionship:{firstCompanion:null,secondCompanion:null}},o={container:"#activeCompanionship",companionship:{container:"#companionshipContainer",comp1:".companionship1",comp2:".companionship2",minTo:"#assignedToVisitContainer"},ministering:{container:"#ministeringInfo",assigned:{container:"#assignedToVisitContainer"},visiting:{container:"#visitingHousehold"}},comments:{container:"#companionshipComments",allComments:"#commentsContainer",view:"#view",form:"#newComment",formError:"#commentError",nav:{view:"#commentNavView",create:"#commentNavCreate"}}},t=function(n,o,e,t){return"\n            <div class='houseComment' data-commentid=\"".concat(n,'">\n                <author>').concat(e," - ").concat(t,'</author>\n                <p class="commentBody">').concat(o,"</p>\n            </div>\n        ")},i={init:function(n){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),i.setDataAttr("companionships",n),i.getUnassignedIndividuals(),e.functions.init(),e.functions.setDataAttr("commentTemplate",t)},setDataAttr:function(o,e){n[o]=e},getDataAttr:function(o){return n[o]},getAllData:function(){return n},workOnCompanionship:function(n){var e=i.getCompanionshipById(n.data("companionshipid"));i.setDataAttr("activeCompanionship",e);var t=o,a=$(t.container);a.attr("data-activeid",e.id),a.attr("data-companionshipid",e.id),$(t.companionship.comp1,a).html(e.firstCompanion.fullName),$(t.companionship.comp2,a).html(e.secondCompanion.fullName),$(t.companionship.minTo).html(n.find(".assignments").html())},getUnassignedIndividuals:function(){$.getJSON("/api/individuals/unassigned",(function(n){i.setDataAttr("unassignedIndividuals",n),i.setDataAttr("ac",!1),i.setAutocomplete()}))},setAutocomplete:function(){var n=document.createElement("input");n.type="text",n.classList.add("form-control"),n.placeholder="Start typing...",n.autocomplete="off";var o=n.cloneNode(!0);n.id="addFirstCompanion",o.id="addSecondCompanion",$("#addCompanionshipInfo #addCompanionship1").html("").append(n),$("#addCompanionshipInfo #addCompanionship2").html("").append(o),i.setDataAttr("ac",!1);var e={data:i.getDataAttr("unassignedIndividuals"),maximumItems:10,treshold:1,highlightTyped:!1},t=a(a({},e),{onSelectItem:function(n){n.label;var o=n.value;i.addCompanion("first",o)}}),s=a(a({},e),{onSelectItem:function(n){n.label;var o=n.value;i.addCompanion("second",o)}}),m=document.getElementById("addFirstCompanion"),p=new Autocomplete(m,t),c=document.getElementById("addSecondCompanion");new Autocomplete(c,s);i.setDataAttr("ac",p)},addCompanion:function(o,e){"first"===o?n.newCompanionship.firstCompanion=e:n.newCompanionship.secondCompanion=e,i.handleFinalizeBtn()},handleFinalizeBtn:function(){var n=$("#finalizeNewCompanionship");i.canSubmitNewCompanionship()?n.removeClass("disabled"):n.addClass("disabled")},finalizeNewCompanionship:function(){$("#addCompanionshipError, #addCompanionshipSuccess").addClass("d-none"),i.canSubmitNewCompanionship()&&$.ajax({url:"/api/createNewCompanionship",type:"post",data:{companionship:n.newCompanionship},success:function(n){if(n.success){var o=$("#allCompanionshipsTable .companionship").first().clone();o.data("companionshipid",n.companionship.id),$(".comp_1",o).text(n.companionship.firstCompanion.fullName),$(".comp_2",o).text(n.companionship.secondCompanion.fullName),$("#allCompanionshipsTable").append(o),$("#addCompanionshipSuccess").removeClass("d-none"),$("#addFirstCompanion, #addSecondCompanion").val(""),i.addCompanion("first",null),i.addCompanion("second",null)}else $("#addCompanionshipError").text(n.error).removeClass("d-none")}})},canSubmitNewCompanionship:function(){return null!==n.newCompanionship.firstCompanion&&null!==n.newCompanionship.secondCompanion},getCompanionshipById:function(o){return n.companionships.filter((function(n){return n.id===o}))[0]},deleteUser:function(){var n=i.getDataAttr("activeCompanionship");$.ajax({url:"/api/companionship/"+n.id+"/delete",type:"post",success:function(o){o.success?($(".companionship[data-companionshipid='"+n.id+"']").remove(),$("#companionshipManagementModal .modal-body").append('<p class="alert alert-success">Companionship was removed successfully.</p>')):$("#companionshipManagementModal .modal-body").append('<p class="alert alert-danger">Could not remove companionship. Please try again later.</p>')}})}};return $(document).on("click","#deleteCompanionship",(function(n){n.preventDefault(),i.deleteUser()})),$(document).on("change","#addFirstCompanion",(function(n){""===$(this).val()&&i.addCompanion("first",null)})),$(document).on("change","#addSecondCompanion",(function(n){""===$(this).val()&&i.addCompanion("second",null)})),$(document).on("click","#finalizeNewCompanionship",(function(n){n.preventDefault(),i.finalizeNewCompanionship()})),$(document).on("show.bs.modal","#companionshipManagementModal",(function(n){var o=$(n.relatedTarget).closest(".companionship");i.workOnCompanionship(o)})),$(document).on("show.bs.modal","#companionshipFeedbackModal",(function(n){var o=$(n.relatedTarget).closest(".companionship"),t=$(this),a=i.getCompanionshipById(o.data("householdid"));t.removeClass("approved rejected proposed").addClass(a.ministeredByStatus),_.each(a.ministered_by.comments,(function(n){assignmentComments.push(n)})),$("#assignStatus",t).html(_.upperFirst(a.ministeredByStatus)),$(".householdName",t).html(a.fullHouseholdName),$(".assignedNames",t).html(a.ministeringComp1+" & "+a.ministeringComp2),e.functions.buildComments(e.functions.getDataAttr("commentTemplate"),$("#aFeedbackContainer",t),assignmentComments)})),{data:i.getAllData,functions:i}}()})();
//# sourceMappingURL=companionship.js.map