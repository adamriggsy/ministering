{"version":3,"file":"/js/households.js","mappings":"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","sources":["webpack:///./resources/js/_comments.js","webpack:///./resources/js/households.js"],"sourcesContent":["export const commentsHelper = function () {\n    'use strict';\n\n    let data = {\n        'commentTemplate': null\n    };\n\n    let css = {\n        'mainContainer': '#assignmentContainer',\n        'viewTypes': {\n            'grid': 'ajr-grid',\n            'list': 'ajr-list'\n        },\n        'modals': {\n            'comment': '#commentModal'\n        },\n        'comments': {\n            'form': '#newComment',\n            'formError': '#commentError'\n        },\n        'household': {\n            'container': '.household',\n            'comments': '.allComments',\n            'status': '.status',\n            'error': '.statusError'\n        }\n    };\n\n    let functions = {\n    \t'init' : function(createUrl) {\n    \t\t$.ajaxSetup({\n\t\t\t    headers: {\n\t\t\t        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n\t\t\t    }\n\t\t\t});\n    \t},\n    \t'setDataAttr' : function(attr, val) {\n    \t\tdata[attr] = val;\n    \t},\n    \t'getDataAttr' : function(attr) {\n    \t\treturn data[attr];\n    \t},\n    \t'getAllData' : function() {\n    \t\treturn data;\n    \t},\n        'createComment' : function(params) {\n    \t\t$.ajax({\n                url: params.url,\n                type: 'post',\n                data: params.data,\n                success: function(response) {\n                    params.successCallback(response);\n                }\n            });\n    \t},\n    \t'buildComments' : function(container, comments, emptyMessage) {\n    \t\tif(typeof emptyMessage === 'undefined') {\n                emptyMessage = 'No comments yet.';\n            }\n\n            container.html('');\n\n            if(comments.length === 0) {\n                container.html('<p>' + emptyMessage + '</p>');\n            }else {\n    \t\t    $.each(comments, function(index, comment) {\n                    let author = comment.author;\n\n                    if(typeof author === 'undefined') {\n                        author = comment.authorInfo;\n                    }\n                    \n    \t\t\t\tlet authorInfo = author.name + ' - ' + _moment(comment.updated_at).format('YYYY-MM-DD LT');\n    \t\t\t\tlet newComment = data.commentTemplate(comment.id, comment.body, authorInfo);\n    \t\t\t\tcontainer.prepend(newComment);\n    \t\t\t});\n            }\n    \t},\n    \t'setCommentError' : function(container, error) {\n    \t\tcontainer.html(error);\n    \t},\n    \t'resetCommentForm' : function(form) {\n    \t\tform.reset();\n    \t},\n        'showCommentsAjaxLoader' : function(container) {\n            container.find('.ajax-loader').removeClass('d-none');\n        },\n        'hideCommentsAjaxLoader' : function(container) {\n            container.find('.ajax-loader').addClass('d-none');\n        }\n    };\n\n    return {\n        data : functions.getAllData,\n        functions: functions\n    }\n}();\n","import {commentsHelper} from './_comments.js';\n\nwindow.householdsHelper = function () {\n    'use strict';\n\n    var data = {\n        'households': null,\n        'currentHouseholdId': null\n    };\n\n    var css = css = {\n        'mainContainer': '#householdsContainer',\n        'modals': {\n            'comment': '#commentModal',\n            'household': {\n                'container': '#householdModal',\n                'comments': '.allComments'\n            }\n        },\n        'comments': {\n            'form': '#newComment',\n            'formError': '#commentError',\n            'commentCount': '.count',\n            'buttons': '.commentBtns'\n        },\n        'household': {\n            'container': '.household',\n            'comments': '.allComments',\n        }\n    };\n\n    const commentTemplate = function commentTemplate(id, body, author ) {\n        return `\n            <div class='householdComment' data-commentid=\"${id}\">\n                <author>${author}</author>\n                <p class=\"commentBody\">${body}</p>\n            </div>\n        `;\n    };\n\n    var functions = {\n    \t'init' : function(households) {\n    \t\t$.ajaxSetup({\n\t\t\t    headers: {\n\t\t\t        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n\t\t\t    }\n\t\t\t});\n\n            functions.setDataAttr('households', households);\n\n            commentsHelper.functions.init();\n            commentsHelper.functions.setDataAttr('commentTemplate', commentTemplate);\n    \t},\n    \t'setDataAttr' : function(attr, val) {\n    \t\tdata[attr] = val;\n    \t},\n    \t'getDataAttr' : function(attr) {\n    \t\treturn data[attr];\n    \t},\n    \t'getAllData' : function() {\n    \t\treturn data;\n    \t},\n        'getActiveContainerById' : function(householdId) {\n            return $('[data-householdid=\"' + householdId + '\"] ');\n        },\n    \t'createComment' : function() {\n    \t\tconst form = $(css.comments.form);\n            const householdId = form.find('#householdId').val();\n            \n            functions.setDataAttr('currentHouseholdId', householdId);\n            let params = {\n                'url' : '/api/household/' + householdId + '/comments/create',\n                'data' : {\n                    form: JSON.stringify(form.serializeArray().reduce(function(m,o){  m[o.name] = o.value; return m;}, {}))\n                },\n                'successCallback' : functions.commentCreateSuccess\n            };\n\n            commentsHelper.functions.createComment(params);\n    \t},\n        'commentCreateSuccess' : function(response) {\n            if(response.saved) {\n                functions.replaceHouseholdComments(response.comments);\n                \n                commentsHelper.functions.resetCommentForm(\n                    $(css.comments.form)[0]\n                );\n\n                let activeContainer = functions.getActiveContainerById(functions.getDataAttr('currentHouseholdId'));\n                commentsHelper.functions.buildComments(\n                    activeContainer.find(css.household.comments),\n                    response.comments,\n                    'No comments yet.'\n                );\n\n                let numComments = response.comments.length;\n                let maxShown = parseInt($(css.mainContainer).data('maxcommentsshown'));\n                \n                activeContainer.find(css.comments.commentCount).text(numComments);\n                if(numComments > maxShown) {\n                    activeContainer.addClass('showAllCommentsBtn')\n                }\n\n                functions.handleBtnGroup(activeContainer.find(css.comments.buttons));\n                $(css.modals.comment).modal('hide');\n            } else {\n                commentsHelper.functions.setCommentError(\n                    $(css.comments.formError),\n                    'Could not save your comment. Refresh the page and try again.'\n                );\n            }\n        },\n        'populateHouseholdModal' : function(referrerBtn) {\n            let householdId = referrerBtn.closest('.household').data('householdid');\n            let houseData = functions.getHouseholdById(householdId);\n            let modal = $(css.modals.household.container);\n            functions.setDataAttr('currentHouseholdId');\n            \n            modal.find('.householdName').text(houseData.fullHouseholdName);\n\n            commentsHelper.functions.buildComments(\n                $(css.modals.household.comments, modal),\n                houseData.comments,\n                'No comments yet.'\n            );\n        },\n        'replaceHouseholdComments' : function(hComments) {\n            let householdKey = data.households.findIndex(function(household) {\n                return (household.id === parseInt(functions.getDataAttr('currentHouseholdId')));\n            });\n\n            data.households[householdKey]['comments'] = hComments;\n        }, \n        'getHouseholdById' : function(id) {\n            let filteredHouseholds = data.households.filter(function(household) {\n                return (household.id === id);\n            });\n            return filteredHouseholds[0];\n        },\n        'handleBtnGroup' : function(container) {\n            let countVisible = $('.btn-group', container).find('button').not(':hidden').length;\n\n            if(countVisible === 1) {\n                container.removeClass('btn-group').addClass('full-width');\n            } else {\n                container.addClass('btn-group').removeClass('full-width');\n            }\n        },\n    };\n\n\t$(document).on('click touch', '#submitComment', function(e) {\n\t\te.preventDefault();\n\t\tfunctions.createComment();\n    });   \n\n    return {\n        data : functions.getAllData,\n        functions: functions\n    }\n}();\n"],"names":["data","functions","commentsHelper","createUrl","$","ajaxSetup","headers","attr","val","params","ajax","url","type","success","response","successCallback","container","comments","emptyMessage","html","length","each","index","comment","author","authorInfo","name","_moment","updated_at","format","newComment","commentTemplate","id","body","prepend","error","form","reset","find","removeClass","addClass","getAllData","window","householdsHelper","css","households","setDataAttr","init","householdId","JSON","stringify","serializeArray","reduce","m","o","value","commentCreateSuccess","createComment","saved","replaceHouseholdComments","resetCommentForm","activeContainer","getActiveContainerById","getDataAttr","buildComments","household","numComments","maxShown","parseInt","mainContainer","commentCount","text","handleBtnGroup","buttons","modals","modal","setCommentError","formError","referrerBtn","closest","houseData","getHouseholdById","fullHouseholdName","hComments","householdKey","findIndex","filter","not","document","on","e","preventDefault"],"sourceRoot":""}